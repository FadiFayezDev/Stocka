# ?? ????? ??????? ??????? - Migration ? snake_case Convention

## ? ??????: ????? ????? 100%

**???????:** ????  
**??????? ???????:** 1  
**???? ??????:** ? ???  

---

## ?? ??????? ???? ?? ????

### ????? ??????:
```
CS1929: There is no property mapped to the column 'AspNetRoles.Id'
```

### ?????:
Migration `SeedRoles` ??? ?????? ????? ??????? ????? **PascalCase**:
```csharp
columns: new[] { "Id", "ConcurrencyStamp", "Name", "NormalizedName" }
```

??? ????? ???????? ?????? **snake_case** ????:
```csharp
options.UseNpgsql(connectionString)
       .UseSnakeCaseNamingConvention();
```

---

## ? ??????? ??????

### ????? ??????:
```
Infrastructure\Migrations\20260218020948_SeedRoles.cs
```

### ?????????:

#### 1?? Up Method - ????? ???????:
```csharp
// ? ???:
columns: new[] { "Id", "ConcurrencyStamp", "Name", "NormalizedName" }

// ? ???:
columns: new[] { "id", "concurrency_stamp", "name", "normalized_name" }
```

#### 2?? Down Method - ??? ??????:
```csharp
// ? ???:
migrationBuilder.Sql("DELETE FROM \"AspNetRoles\"");

// ? ???:
migrationBuilder.Sql("DELETE FROM \"asp_net_roles\"");
```

---

## ?? ?????? ??????

### InfrastructureRegistration.cs ?
```csharp
services.AddDbContext<AppDbContext>(options =>
{
    options.UseNpgsql(connectionString)
    .UseSnakeCaseNamingConvention();  // ? ?????? ??????
});
```

### AppDbContext.cs ?
```csharp
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    base.OnModelCreating(modelBuilder);
    modelBuilder.ApplyConfigurationsFromAssembly(typeof(AppDbContext).Assembly); 
    modelBuilder.Ignore<IdentityPasskeyData>();
}
```

---

## ?? ???? ????????? ???????

### ??????? 1: Dapper Repositories ?
- 21 Query Repository
- 22 ???? ????
- ???? ????? ??????? ? snake_case

### ??????? 2: EF Core Configurations ?
- 22 Configuration File
- ????? ??????? ? snake_case
- Indexes ? Filters ? snake_case

### ??????? 3: Migrations ?
- Migration ??????? (20260218013438) ?
- SeedRoles Migration (20260218020948) ? **?? ??????? ????**

---

## ?? ?????? ???????

```
? ??????: ??? ???? ?????
? Migration: ????? ???????
? Configurations: ???????
? Repositories: ?????
? Database Convention: snake_case
```

---

## ?? ????? ???????? ????????

1. **DAPPER_SNAKE_CASE_UPDATE_REPORT.md** - ??????? Dapper Queries
2. **CONFIGURATIONS_SNAKE_CASE_UPDATE_REPORT.md** - ??????? Configurations
3. **SNAKE_CASE_FINAL_COMPLETION_REPORT.md** - ??????? ??????? ??????
4. **SEEDROLES_MIGRATION_FIX.md** - ????? SeedRoles (????? ??????)

---

## ?? ??????? ???????

1. ? ????? Migration ??? ????? ????????:
```bash
dotnet ef database update
```

2. ? ?????? ?? ????? ???????:
```sql
SELECT * FROM "asp_net_roles";
```

3. ? ?????? ??????? ??????

---

## ?? ????? ?????? ??? ???????

```csharp
using Domain.Enums;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

namespace Infrastructure.Migrations
{
    /// <inheritdoc />
    public partial class SeedRoles : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            string[] roleNames = Enum.GetNames(typeof(SystemRolesType));

            var roles = new object[roleNames.Length, 4];

            for (int i = 0; i < roleNames.Length; i++)
            {
                roles[i, 0] = Guid.NewGuid().ToString();
                roles[i, 1] = Guid.NewGuid().ToString();
                roles[i, 2] = roleNames[i];
                roles[i, 3] = roleNames[i].ToUpper();
            }

            migrationBuilder.InsertData(
                table: "AspNetRoles",
                columns: new[] { "id", "concurrency_stamp", "name", "normalized_name" },
                values: roles
             );
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.Sql("DELETE FROM \"asp_net_roles\"");
        }
    }
}
```

---

## ? ??????? ???????

? **??????? ?????** ?? PostgreSQL + snake_case  
? **?? ???? ?????** ??? ????? ??? Migration  
? **???????? ????? ???? ????**  
? **??????? ???? ???????**  

---

## ?? ??????? ????????

### ? ????? ??????? ?????? ????? 100%

???? ????? ??????? ????? ??????:
- ? Database Layer (PostgreSQL + snake_case)
- ? EF Core Configuration
- ? Dapper Query Layer
- ? Migration Files
- ? Identity Seeding

**??????:** ???? ??????? ??

---

**???????:** ????  
**???????:** v1.0  
**??????:** ? ?????  

?? **?? ?? ???? ??????? ?????**

