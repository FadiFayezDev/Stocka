# ? ?????? ???? - ???? ?????? ??????

## ?? ????? ?????? ?? ???? ???????

---

## 1?? ?????? ?????? (Build Test)

### ??????:
```powershell
dotnet clean
dotnet build
```

### ??????? ????????:
```
? Build succeeded.
? 0 errors
? 0 warnings (?? warnings ????? ???)
? All projects compiled
```

### ??? ???:
```powershell
# ????:
dotnet restore
dotnet build --verbose
```

---

## 2?? ?????? Migration

### ??????:
```powershell
# ?? Package Manager Console
Update-Database -Context AppDbContext -Verbose
```

### ??????? ????????:
```
? Build command completed successfully.
? Applying migration...
? Done. [Time]
? Migrations were applied successfully
```

### ?? ???? ?????:
```powershell
# ???? ?? ??? migrations
Get-Migration -Context AppDbContext

# ???? ?? output ????
Update-Database -Context AppDbContext -Verbose
```

---

## 3?? ?????? Database (PostgreSQL)

### ???? ?? PostgreSQL:
```bash
psql -h localhost -U your_user -d your_database
```

### ?? ?????? pgAdmin

### ????? ??? Default Values:
```sql
-- ? Test 1: Employees HireDate
SELECT column_name, column_default
FROM information_schema.columns
WHERE table_name = 'employees' AND column_name = 'hire_date';

-- Expected Output:
-- column_name | column_default
-- hire_date   | now()

-- ? Test 2: JournalEntries EntryDate
SELECT column_name, column_default
FROM information_schema.columns
WHERE table_name = 'journalentries' AND column_name = 'entrydate';

-- Expected: now()

-- ? Test 3: Orders OrderDate
SELECT column_name, column_default
FROM information_schema.columns
WHERE table_name = 'orders' AND column_name = 'orderdate';

-- Expected: now()

-- ? Test 4: Expenses ExpenseDate
SELECT column_name, column_default
FROM information_schema.columns
WHERE table_name = 'expenses' AND column_name = 'expensedate';

-- Expected: now()

-- ? Test 5: Purchases PurchaseDate
SELECT column_name, column_default
FROM information_schema.columns
WHERE table_name = 'purchases' AND column_name = 'purchasedate';

-- Expected: now()

-- ? Test 6: Batches CreatedAt
SELECT column_name, column_default
FROM information_schema.columns
WHERE table_name = 'batches' AND column_name = 'createdat';

-- Expected: now()

-- ? Test 7: StockMovements CreatedAt
SELECT column_name, column_default
FROM information_schema.columns
WHERE table_name = 'stockmovements' AND column_name = 'createdat';

-- Expected: now()
```

### ????? ??? Index Filters:
```sql
-- ? Test 1: Customers UserId Index
SELECT indexdef FROM pg_indexes
WHERE tablename = 'customers' AND indexname = 'ix_customers_user_id';

-- Expected: ????? ??? "user_id" IS NOT NULL (?? quotes!)

-- ? Test 2: Employees UserId Index
SELECT indexdef FROM pg_indexes
WHERE tablename = 'employees' AND indexname = 'ix_employees_user_id';

-- Expected: ????? ??? "user_id" IS NOT NULL (?? quotes!)
```

### ???????? Database:
```sql
-- ???? ?? ??? ???????
SELECT COUNT(*) as table_count 
FROM information_schema.tables 
WHERE table_schema = 'public';

-- Expected: ~30+ tables

-- ???? ?? ??? ??? Indexes
SELECT COUNT(*) as index_count 
FROM pg_indexes 
WHERE schemaname = 'public';

-- Expected: 50+ indexes

-- ???? ?? ??? Foreign Keys
SELECT COUNT(*) as fk_count
FROM information_schema.table_constraints
WHERE constraint_type = 'FOREIGN KEY';

-- Expected: 20+ foreign keys
```

---

## 4?? ?????? ??????? (Application Test)

### ???? ???????:
```powershell
dotnet run
```

### ??????? ????????:
```
? Application starts without errors
? No exceptions in logs
? Database connection successful
? Can access API endpoints
```

### ????? ??? APIs:
```powershell
# ????? health check
curl http://localhost:5000/health

# ?? ?? PowerShell:
Invoke-WebRequest -Uri "http://localhost:5000/health"

# Expected: 200 OK
```

### ????? ??????? ?? Database:
```csharp
// ?? ?? service
var employees = await dbContext.Employees.ToListAsync();
// ? Should return without errors

var orders = await dbContext.Orders.ToListAsync();
// ? Should return without errors

var expenses = await dbContext.Expenses.ToListAsync();
// ? Should return without errors
```

### ????? ??????? (Create):
```csharp
// Employee creation
var employee = new Employee(
    userId: null,
    brandId: brandId,
    jobTitle: "Test Manager",
    salary: 5000m,
    hireDate: null // ? ??????? ???????? ?? Database default
);

dbContext.Employees.Add(employee);
await dbContext.SaveChangesAsync();

// ? Should save without errors
// ? HireDate should be set to now()

// Verify
var savedEmployee = await dbContext.Employees
    .FirstOrDefaultAsync(e => e.Id == employee.Id);

Assert.NotEqual(default(DateTime), savedEmployee.HireDate);
// ? HireDate ??? ?? ???? ?????
```

---

## 5?? ?????? ?????? (Performance Test)

### ??? ????????:
```sql
-- ??? ?????? ??????? ????????
INSERT INTO orders (id, brand_id, employee_id, order_date, status, total_amount)
VALUES (uuid_generate_v4(), 'brand_id', 'employee_id', now(), 'Pending', 0)
-- ??? ??? 1000 ???
```

### ????? ???? Query:
```sql
-- ? ???? Index (??? ???????)
SELECT * FROM orders WHERE order_date > '2024-01-01';
-- ??????: ~500ms (???????)

-- ? ?? Index (??? ???????)
SELECT * FROM orders WHERE order_date > '2024-01-01';
-- ??????: ~10ms (???????)
-- ? ????: 50x ????!
```

### ????? Multi-tenant Query:
```sql
-- ? ???? Composite Index
SELECT * FROM orders 
WHERE brand_id = 'abc' AND order_date > '2024-01-01';
-- ??????: ~500ms

-- ? ?? Composite Index
SELECT * FROM orders 
WHERE brand_id = 'abc' AND order_date > '2024-01-01';
-- ??????: ~5ms
-- ? ????: 100x ????!
```

---

## 6?? ?????? ????????? (Compatibility Test)

### ???? ?? ??? Functions:
```sql
-- ? ??? ?? ????
SELECT NOW();
-- Result: current timestamp

-- ? ??? ?? ????
SELECT NOW() AT TIME ZONE 'UTC';
-- Result: current UTC timestamp

-- ? ??? ?? ???? ?? PostgreSQL
SELECT GETUTCDATE();
-- Error: Function not found
```

### ???? ?? ??? Syntax:
```sql
-- ? ??? ?? ???? (PostgreSQL quotes)
SELECT "user_id" FROM customers WHERE "user_id" IS NOT NULL;
-- Result: ????? IDs

-- ? ??? ?? ???? (Unquoted ?? ??? ???????)
SELECT user_id FROM customers;
-- Result: ????? IDs

-- ?? ?? ?? ???? (SQL Server brackets)
SELECT [user_id] FROM customers;
-- Error: ?? ???? ???????
```

---

## ?? ?????? ???? (Full Test Suite)

### ????? ???? Configurations:

```csharp
[TestClass]
public class ConfigurationTests
{
    private AppDbContext _dbContext;

    [TestInitialize]
    public void Setup()
    {
        var options = new DbContextOptionsBuilder<AppDbContext>()
            .UseNpgsql("your_connection_string")
            .Options;
        _dbContext = new AppDbContext(options);
    }

    [TestMethod]
    public void EmployeeHireDate_ShouldHaveNowDefault()
    {
        // Arrange & Act
        var employee = new Employee(null, Guid.NewGuid(), "Manager", 5000);
        
        // Assert
        Assert.AreNotEqual(default(DateTime), employee.HireDate);
    }

    [TestMethod]
    public void JournalEntry_ShouldHaveNowDefault()
    {
        var entry = new JournalEntry { BrandId = Guid.NewGuid() };
        Assert.AreNotEqual(default(DateTime), entry.EntryDate);
    }

    [TestMethod]
    public void Order_ShouldHaveNowDefault()
    {
        var order = new Order();
        Assert.AreNotEqual(default(DateTime), order.OrderDate);
    }

    // ... ????? ??? entity
}
```

---

## ? Checklist ??????????

- [ ] Build successful
- [ ] Migration applied
- [ ] Database created
- [ ] Default values working (7 entities)
- [ ] Index filters correct (2 indexes)
- [ ] Application runs
- [ ] APIs respond
- [ ] Database queries work
- [ ] Insert operations work
- [ ] Performance improved
- [ ] No errors in logs
- [ ] Compatibility verified

---

## ?? ??????? ????????

### ? ???? ?????????? ??? ?? ????:

```
? Build Test:        PASSED
? Migration Test:    PASSED
? Database Test:     PASSED
? Default Values:    PASSED (7/7)
? Index Filters:     PASSED (2/2)
? Application Test:  PASSED
? Performance Test:  PASSED (50-1000x improvement)
? Compatibility:     PASSED

Overall: ? ALL TESTS PASSED
```

---

## ?? ??? ??? ??????

### Build failed?
```powershell
dotnet clean
dotnet restore
dotnet build
```

### Migration failed?
```powershell
Get-Migration
Update-Database -Context AppDbContext -Verbose
```

### Database test failed?
```sql
-- ???? ?? ??????
\dt

-- ???? ?? ??????
\d employees

-- ???? ?? ??? default
SELECT * FROM information_schema.columns 
WHERE table_name = 'employees';
```

### Application test failed?
```
???? ?????:
1. Connection string ????
2. Database ?? ???? ???
3. Migration ?? ??????

????:
1. ???? ?? appsettings.json
2. ???? Update-Database
3. ???? ??????? ??? ????
```

---

## ?? ???????

??? ???? ???? ?????????? ?????:

```
? ???? ?????? ?? ?????? ?????
? Database ?????? ?? PostgreSQL 100%
? ??????? ???? ???? ?????
? ?????? ?????? ???? ????
? ???? ??? Production

?? LET'S DEPLOY IT!
```

---

**Happy Testing! ??**
