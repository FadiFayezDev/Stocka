# ?? ???? ????: ??????? Configurations ?? Strong Domain Models

## ?? ?? ?? ??????

?? ????? **???? 19 EF Core Configuration Files** ??????? ?? ??????? ?????? ??????? ?? Domain Layer.

---

## ?? ??????? ???????? (19 File)

### ?? Core Layer (3 Files)
1. ? **BranchConfiguration.cs**
   - ????? `Warehouses` collection
   - `Restrict` delete behavior

2. ? **CustomerConfiguration.cs**
   - `HasDefaultValue(0)` ??? `LoyaltyPoints`
   - ????? `Sales` collection

3. ? **EmployeeConfiguration.cs**
   - Default values ??? `HireDate` ? `IsActive`
   - `IsRequired()` ??? `JobTitle`

### ?? Product Layer (6 Files)
4. ? **ProductConfiguration.cs**
   - ????? 4 collections
   - ???? `OnDelete` ????? ??? `Restrict`

5. ? **ProductCategoryConfiguration.cs**
   - ????? `Products` collection
   - `AutoInclude()` ??? Navigation

6. ? **BatchConfiguration.cs**
   - ????? 3 collections
   - `HasDefaultValueSql("GETUTCDATE()")` ??? `CreatedAt`

7. ? **WarehouseConfiguration.cs**
   - ????? `Type` ??? `HasConversion<string>()`
   - ????? 2 collections

8. ? **WarehouseBatchConfiguration.cs**
   - `Quantity` ?????
   - ?????? ??? `Unique` constraint

9. ? **StockMovementConfiguration.cs**
   - ????? `MovementType` enum
   - `Restrict` delete behavior

### ?? Purchasing Layer (3 Files)
10. ? **SupplierConfiguration.cs**
    - ????? `Purchases` collection
    - `MaxLength` ??? Contact Info

11. ? **PurchaseConfiguration.cs**
    - Default values ??? `PurchaseDate` ? `TotalAmount`
    - `Cascade` delete ??? Items

12. ? **PurchaseItemConfiguration.cs**
    - ????? `Batches` collection
    - ???? Fields ??????

### ?? Sales Layer (2 Files)
13. ? **SaleConfiguration.cs**
    - ????? `Status` enum
    - `Cascade` delete ??? Items
    - Default values

14. ? **SaleItemConfiguration.cs**
    - ???? Prices ??????
    - `Restrict` delete behavior

### ?? Accounting Layer (3 Files)
15. ? **AccountConfiguration.cs**
    - ????? `Type` enum
    - ????? `JournalEntryLines` collection

16. ? **JournalEntryConfiguration.cs**
    - Default value ??? `EntryDate`
    - `Cascade` delete ??? Lines
    - Indexes ??? Performance

17. ? **JournalEntryLineConfiguration.cs**
    - `HasConversion<string>()` ??? Properties
    - Indexes ??? Performance-critical columns

### ?? Expense Layer (2 Files)
18. ? **ExpenseConfiguration.cs**
    - Default value ??? `ExpenseDate`
    - `MaxLength(500)` ??? `Notes`

19. ? **ExpenseCategoryConfiguration.cs**
    - ????? `Expenses` collection
    - `AutoInclude()` ??? Navigation

---

## ?? ????????? ????????

### 1. Collection Management ?
```csharp
// ?? collection ????? ???? ????
builder.HasMany(d => d.Items)
    .WithOne(d => d.Parent)
    .HasForeignKey(d => d.ParentId)
    .OnDelete(DeleteBehavior.Cascade);

// Auto-loading
builder.Navigation(d => d.Items).AutoInclude();
```

### 2. Default Values ?
| Property | Default | ????? |
|----------|---------|-------|
| `CreatedAt` | `GETUTCDATE()` | System.DateTime |
| `LoyaltyPoints` | `0` | Integer |
| `TotalAmount` | `0` | Decimal |
| `IsActive` | `true` | Boolean |

### 3. Enum Conversion ?
```csharp
// Enums ?????? ?? Strings ?? Database
builder.Property(e => e.Status)
    .HasConversion<string>()
    .HasMaxLength(50);
```

### 4. Required Fields ?
| Table | Required Fields |
|-------|-----------------|
| Products | `Name` |
| Branches | `Name` |
| Warehouses | `Name` |
| Employees | `JobTitle` |
| Accounts | `Name` |
| Categories | `Name` |

### 5. Delete Behaviors ?
| Relationship | Behavior | Reason |
|---|---|---|
| Parent ? Items | `Cascade` | ??? ??? Parent ???? ??? Items |
| Entity ? Master | `Restrict` | ??? ??? ???????? ???????? |
| Optional FK | `Restrict` | ????? ?? Orphaned Records |

### 6. Performance Optimization ?
- ? Indexes ??? Foreign Keys
- ? Indexes ??? Search columns
- ? AutoInclude ??? Collections ??????
- ? Unique constraints ?????

---

## ?? ?????? Before/After

### Customer Table

**Before:**
```sql
CREATE TABLE Customers (
    Id UNIQUEIDENTIFIER PRIMARY KEY,
    UserId UNIQUEIDENTIFIER,
    BrandId UNIQUEIDENTIFIER,
    LoyaltyPoints INT
);
```

**After:**
```sql
CREATE TABLE Customers (
    Id UNIQUEIDENTIFIER PRIMARY KEY,
    UserId UNIQUEIDENTIFIER UNIQUE FILTERED,
    BrandId UNIQUEIDENTIFIER,
    LoyaltyPoints INT DEFAULT 0,  -- ? ??????
    -- ? Collections ?????
    -- ? Constraints ?????
);
```

### Sale Table

**Before:**
```sql
CREATE TABLE Sales (
    Id UNIQUEIDENTIFIER PRIMARY KEY,
    BrandId UNIQUEIDENTIFIER,
    EmployeeId UNIQUEIDENTIFIER,
    CustomerId UNIQUEIDENTIFIER,
    SaleDate DATETIME,
    Status NVARCHAR(MAX),  -- ???? max length
    TotalAmount DECIMAL(18,2)
);
```

**After:**
```sql
CREATE TABLE Sales (
    Id UNIQUEIDENTIFIER PRIMARY KEY,
    BrandId UNIQUEIDENTIFIER NOT NULL,
    EmployeeId UNIQUEIDENTIFIER NOT NULL,
    CustomerId UNIQUEIDENTIFIER,
    SaleDate DATETIME DEFAULT GETUTCDATE(),  -- ?
    Status NVARCHAR(50),  -- ? ?? max length
    TotalAmount DECIMAL(18,2) DEFAULT 0,  -- ?
    FOREIGN KEY (SaleId) ... ON DELETE CASCADE  -- ?
);
```

---

## ??? ????????? ???????

### EF Core Features ?????????:
- ? `HasMany/WithOne` - Collection relationships
- ? `HasConversion<T>()` - Enum/Type conversion
- ? `HasDefaultValue()` - Default values
- ? `HasDefaultValueSql()` - SQL default values
- ? `IsRequired()` - NOT NULL constraints
- ? `HasMaxLength()` - String length constraints
- ? `HasIndex()` - Database indexes
- ? `HasFilter()` - Filtered unique indexes
- ? `AutoInclude()` - Auto-loading navigation
- ? `OnDelete()` - Cascade/Restrict behaviors

---

## ?? ??????? ???????

### 1. Type Safety ?
```csharp
// EF Core ???? ??? Collections ????
var customer = dbContext.Customers.First();
var sales = customer.Sales;  // ? Works
```

### 2. Performance ?
```csharp
// Auto-included collections ???? queries
var customers = dbContext.Customers
    .ToList();  // ? Sales ????? ????????
```

### 3. Data Integrity ?
```sql
-- Database ???? Default Values
INSERT INTO Customers (Id, UserId, BrandId)
VALUES (NEWID(), NULL, @BrandId);

-- LoyaltyPoints = 0 ????????
```

### 4. Business Logic ?
```csharp
// Entity methods ???? ??????
customer.AddLoyaltyPoints(50);  // ? Works
var profit = saleItem.GetProfit();  // ? Works
```

---

## ?? ????? ???????

### 1. ????? Migration:
```powershell
Add-Migration UpdateConfigurationsForStrongModels
```

### 2. ?????? Migration:
```powershell
# ???? ?? ??? Migration file
# Infrastructure/Migrations/[timestamp]_UpdateConfigurationsForStrongModels.cs
```

### 3. ????? ??? Database:
```powershell
Update-Database
```

### 4. ?????? ?? ???????:
```sql
-- ?? SQL Server Management Studio
SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES;
```

---

## ? ????? ??????? ???????

1. **CONFIGURATIONS_UPDATES.md**
   - ??? ?????? ??? ?????
   - ????? ???/???
   - ????? ????????

2. **MIGRATION_STEPS.md**
   - ????? ????? ? ????? Migrations
   - Troubleshooting guide
   - ???? ?????????

3. **README_MIGRATIONS.md** (??? ?????)
   - ???? ????
   - Quick reference

---

## ?? Next Steps

### ????:
- [ ] ????? `Add-Migration UpdateConfigurationsForStrongModels`
- [ ] ?????? ??? Migration file
- [ ] ????? `Update-Database`

### ???? ?????:
- [ ] ?????? ???????? ????????
- [ ] ?????? ?? Default Values
- [ ] ????? Unit Tests

### ????? ?????:
- [ ] ????? Application Layer Commands
- [ ] ????? Query Repositories
- [ ] ????? Integration Tests

---

## ?? Statistics

| ????? | ????? | ?????? |
|--------|-------|--------|
| Core Configurations | 3 | ? ????? |
| Product Configurations | 6 | ? ????? |
| Purchasing Configurations | 3 | ? ????? |
| Sales Configurations | 2 | ? ????? |
| Accounting Configurations | 3 | ? ????? |
| Expense Configurations | 2 | ? ????? |
| **???????** | **19** | **? ?????** |

---

## ?? ??????? ????????

??? Project ???? ????:

? **Strong Domain Models** ?? Business Logic  
? **Updated EF Core Configurations** ??????? ?? ???????  
? **Database Integrity** ????? ?? Constraints ? Default Values  
? **Performance Optimized** ?? Indexes ? Auto-Include  
? **Type-Safe** ?? Proper Collection Configuration  
? **Business-Aligned** ?? Enum Conversion ? Delete Behaviors  

---

## ?? ????????

??? ????? ?? ?????:

1. ???? ?? **CONFIGURATIONS_UPDATES.md** ????????
2. ???? **MIGRATION_STEPS.md** ???????
3. ???? **Troubleshooting** section ?? MIGRATION_STEPS.md
4. ???? ?? ?? **Default Project = Infrastructure** ?? Package Manager Console

---

## ?? ???????

- [EF Core Configuration Documentation](https://learn.microsoft.com/en-us/ef/core/modeling/)
- [EF Core Migrations](https://learn.microsoft.com/en-us/ef/core/managing-schemas/migrations/)
- [EF Core Relationships](https://learn.microsoft.com/en-us/ef/core/modeling/relationships/)
- [Database Constraints](https://learn.microsoft.com/en-us/sql/relational-databases/tables/primary-and-foreign-key-constraints)

---

## ? Checklist

- [ ] ????? ??? ?? ??? Updated Configurations
- [ ] ???? ??????? ?? ?? ?????
- [ ] ????? Migration ????
- [ ] ???? Database updates
- [ ] ????? ?? ???????
- [ ] ??? ?? Testing ???????? ????????
- [ ] ???? ??? Team ?? ?????????

---

**?? ??????? ??:** `[Current Date]`  
**??? ??????? ???????:** 19 Configuration Files  
**???? ??????:** ? Build Successful  
**?????? ???????:** ? Ready for Deployment
