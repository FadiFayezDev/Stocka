# ?? ??? ?????? EF Core Configurations

## ?? ????????? ????????

### 1. BrandMembershipConfiguration
**???????:** ApplicationUserId ??????

```csharp
// ? ????
public void Configure(EntityTypeBuilder<BrandMembership> builder)
{
    builder.HasKey(bm => new { bm.BrandId, bm.UserId });
    
    // ? FK ????
    builder.HasOne<ApplicationUser>()
        .WithOne()
        .HasForeignKey<BrandMembership>(bm => bm.ApplicationUserId);
}

// ? ????
public void Configure(EntityTypeBuilder<BrandMembership> builder)
{
    builder.HasKey(bm => new { bm.BrandId, bm.UserId });
    
    builder.HasOne<ApplicationUser>()
        .WithMany()
        .HasForeignKey(bm => bm.UserId)
        .OnDelete(DeleteBehavior.Cascade);
    
    builder.HasOne(bm => bm.Brand)
        .WithMany()
        .HasForeignKey(bm => bm.BrandId)
        .OnDelete(DeleteBehavior.Cascade);
}
```

---

### 2. Configurations ????? ?? HasDefaultValueSql ?? PostgreSQL

**?????????:**

#### OrderConfiguration
```csharp
builder.Property(o => o.OrderDate)
    .HasDefaultValueSql("NOW()");  // ? PostgreSQL

builder.Property(o => o.TotalAmount)
    .HasDefaultValue(0);           // ? ????
```

#### PurchaseConfiguration
```csharp
builder.Property(p => p.PurchaseDate)
    .HasDefaultValueSql("NOW()");  // ? PostgreSQL

builder.Property(p => p.TotalAmount)
    .HasDefaultValue(0);           // ? ????
```

#### EmployeeConfiguration
```csharp
builder.Property(e => e.HireDate)
    .HasDefaultValueSql("NOW()");  // ? PostgreSQL

builder.Property(e => e.IsActive)
    .HasDefaultValue(true);        // ? ????
```

---

### 3. ????? Indexes ??? Performance

#### CustomerConfiguration
```csharp
// ? ?????
builder.HasIndex(c => c.BrandId)
    .HasDatabaseName("IX_Customers_BrandId");

builder.HasIndex(c => new { c.BrandId, c.UserId })
    .HasDatabaseName("IX_Customers_BrandId_UserId");
```

#### SupplierConfiguration
```csharp
// ? ?????
builder.HasIndex(s => s.BrandId)
    .HasDatabaseName("IX_Suppliers_BrandId");

builder.HasIndex(s => s.Email)
    .HasDatabaseName("IX_Suppliers_Email");
```

#### ProductConfiguration
```csharp
// ? ?????
builder.HasIndex(p => p.Barcode)
    .IsUnique()
    .HasDatabaseName("IX_Products_Barcode");

builder.HasIndex(p => new { p.BrandId, p.CategoryId })
    .HasDatabaseName("IX_Products_BrandId_CategoryId");
```

---

### 4. ????? Unique Constraints

#### OrderConfiguration
```csharp
// ? ?????
builder.HasAlternateKey(o => new { o.BrandId, o.Id });
```

#### PurchaseConfiguration
```csharp
// ? ?????
builder.HasIndex(p => new { p.BrandId, p.SupplierId })
    .HasDatabaseName("IX_Purchases_BrandId_SupplierId");
```

---

## ?? ???? ?????????

| ????? | ??????? | ???????? |
|------|---------|---------|
| BrandMembershipConfiguration | ??? ApplicationUserId | ?? ???? |
| OrderConfiguration | ????? GETUTCDATE() ? NOW() | ?? ???? |
| PurchaseConfiguration | ????? GETUTCDATE() ? NOW() | ?? ???? |
| EmployeeConfiguration | ????? GETUTCDATE() ? NOW() | ?? ???? |
| ExpenseConfiguration | ????? GETUTCDATE() ? NOW() | ?? ???? |
| JournalEntryConfiguration | ????? GETUTCDATE() ? NOW() | ?? ???? |
| BatchConfiguration | ????? GETUTCDATE() ? NOW() | ?? ???? |
| StockMovementConfiguration | ????? GETUTCDATE() ? NOW() | ?? ???? |
| CustomerConfiguration | ????? Indexes | ?? ???? |
| ProductConfiguration | ????? Indexes | ?? ???? |
| SupplierConfiguration | ????? Indexes | ?? ???? |

---

## ?? ??????? ?????????

### Step 1: ????? ???? Configurations
```powershell
# ????? ?? ??? ???? ?????? ?????
```

### Step 2: ????? Build
```bash
dotnet build
```

### Step 3: ????? Migration ????
```powershell
Add-Migration UpdateConfigurationsForPostgreSQL
```

### Step 4: ?????? Migration
```powershell
# ???? ?? ????:
# - AlterColumn ?? defaultValueSql: "NOW()"
# - CreateIndex ?? Performance
# - DropColumn ?? ApplicationUserId
```

### Step 5: ????? Migration
```powershell
Update-Database
```

---

## ? ????? ??????

??? ???????:
- [ ] Backup ?? Database
- [ ] ?? Configurations ?????
- [ ] Build successful ???? errors
- [ ] Migration ????? ??? ????????? ???????
- [ ] ?? ???? data loss

??? ???????:
- [ ] Database updated ?????
- [ ] Unique Indexes ??????
- [ ] Default Values ?????
- [ ] Relationships ?????
- [ ] Application ???? ???? errors

---

## ?? ?????? ????????

? All Configurations PostgreSQL-compatible  
? Default Values ?????  
? Performance Indexes ??????  
? Unique Constraints ?????  
? ApplicationUserId ?????  
? Database ?????? ?? EF Core Models
