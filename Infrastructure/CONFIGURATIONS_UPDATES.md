# ??????? EF Core Configurations - Updated Entity Framework Configurations

## ?? ???? ?????????

?? ????? ???? **EF Core Configurations** ??????? ?? ??????? ?????? ??????? ?? Domain Layer.

---

## ?? 22 Configuration File ??????:

### 1. **Core Entities**

#### ? BranchConfiguration
- ????? `IsRequired()` ??? ??? Name
- ????? `Warehouses` collection ?? `HasMany/WithOne`
- ????? `OnDelete` ?? `ClientSetNull` ??? `Restrict`

#### ? CustomerConfiguration
- ????? `HasDefaultValue(0)` ??? `LoyaltyPoints`
- ????? `Sales` collection
- ????? `AutoInclude()` ??? Navigation

#### ? EmployeeConfiguration
- ????? `HasDefaultValueSql("GETUTCDATE()")` ??? `HireDate`
- ????? `HasDefaultValue(true)` ??? `IsActive`
- ??? `JobTitle` ????? ?? `IsRequired()`

---

### 2. **Product Entities**

#### ? ProductConfiguration
- ????? **4 Collections**:
  - `Batches`
  - `PurchaseItems`
  - `SaleItems`
  - `StockMovements`
- ??? `Name` ????? ?? `IsRequired()`
- ????? ???? `OnDelete` ??? `Restrict`

#### ? ProductCategoryConfiguration
- ????? `Products` collection
- ??? `Name` ????? ?? `IsRequired()`
- ????? `AutoInclude()` ??? Navigation

#### ? BatchConfiguration
- ????? `HasDefaultValueSql("GETUTCDATE()")` ??? `CreatedAt`
- ????? **3 Collections**:
  - `SaleItems`
  - `StockMovements`
  - `WarehouseBatches`

#### ? WarehouseConfiguration
- ????? `Type` ??? `HasConversion<string>()`
- ????? **2 Collections**:
  - `StockMovements`
  - `WarehouseBatches`
- ????? `AutoInclude()` ??? Collections

#### ? WarehouseBatchConfiguration
- ????? `Quantity` ?? `IsRequired()`
- ?????? ??? `Unique` constraint ??? `(WarehouseId, BatchId)`

#### ? StockMovementConfiguration
- ????? `MovementType` ??? `HasConversion<string>()`
- ????? `HasDefaultValueSql("GETUTCDATE()")` ??? `CreatedAt`
- ??? `Quantity` ?????

---

### 3. **Purchasing Entities**

#### ? SupplierConfiguration
- ????? constraints ??? `Phone`, `Email`, `Address`
- ????? `Purchases` collection
- ??? `Name` ????? ?? `IsRequired()`

#### ? PurchaseConfiguration
- ????? `HasDefaultValueSql("GETUTCDATE()")` ??? `PurchaseDate`
- ????? `HasDefaultValue(0)` ??? `TotalAmount`
- ????? `PurchaseItems` collection ?? `Cascade` delete

#### ? PurchaseItemConfiguration
- ????? `Batches` collection
- ??? `Quantity` ? `UnitCost` ??????
- ????? `OnDelete` ??? Batch ??? `Restrict`

---

### 4. **Sales Entities**

#### ? SaleConfiguration
- ????? `Status` ??? `HasConversion<string>()`
- ????? `HasDefaultValueSql("GETUTCDATE()")` ??? `SaleDate`
- ????? `HasDefaultValue(0)` ??? `TotalAmount`
- ????? `SaleItems` collection ?? `Cascade` delete

#### ? SaleItemConfiguration
- ??? `Quantity`, `CostPrice`, `UnitPrice` ??????
- ????? `OnDelete` ??? Batch ?? `ClientSetNull` ??? `Restrict`

---

### 5. **Accounting Entities**

#### ? AccountConfiguration
- ????? `Type` ??? `HasConversion<string>()`
- ??? `Name` ????? ?? `IsRequired()`
- ????? `JournalEntryLines` collection

#### ? JournalEntryConfiguration
- ????? `HasDefaultValueSql("GETUTCDATE()")` ??? `EntryDate`
- ????? `JournalEntryLines` collection ?? `Cascade` delete
- ????? `OnDelete` ??? `Restrict` ??? Brand

#### ? JournalEntryLineConfiguration
- ????? Indexes ??? Performance:
  - `JournalEntryId`
  - `AccountId`
- ????? `OnDelete` ?? `ClientSetNull` ??? `Cascade`

---

### 6. **Expense Entities**

#### ? ExpenseConfiguration
- ????? `HasDefaultValueSql("GETUTCDATE()")` ??? `ExpenseDate`
- ????? `HasMaxLength(500)` ??? `Notes`
- ????? `OnDelete` ??? `Restrict`

#### ? ExpenseCategoryConfiguration
- ??? `Name` ????? ?? `IsRequired()`
- ????? `Expenses` collection
- ????? `AutoInclude()` ??? Navigation

---

## ?? ????????? ????????:

### 1. **Collection Management** ?
```csharp
// ???? ???? Collections ????? ???? ????
builder.HasMany(d => d.Items)
    .WithOne(d => d.Parent)
    .HasForeignKey(d => d.ParentId)
    .OnDelete(DeleteBehavior.Cascade); // ?? Restrict ??? ???????
```

### 2. **Enum Conversion** ?
```csharp
// ????? Enums ??? strings ?? Database
builder.Property(e => e.Status)
    .HasConversion<string>()
    .HasMaxLength(50);
```

### 3. **Default Values** ?
```csharp
// ??? ???????? ?? Database
builder.Property(e => e.CreatedAt)
    .HasDefaultValueSql("GETUTCDATE()");

builder.Property(c => c.LoyaltyPoints)
    .HasDefaultValue(0);
```

### 4. **Required Properties** ?
```csharp
// Properties ?????? (NOT NULL)
builder.Property(e => e.Name)
    .IsRequired()
    .HasMaxLength(200);
```

### 5. **AutoInclude Navigation** ?
```csharp
// ????? ?????? ??? Collections
builder.Navigation(d => d.Items).AutoInclude();
```

### 6. **Delete Behaviors** ?
| Relationship | Delete Behavior | ????? |
|---|---|---|
| Parent ? Child Items | `Cascade` | ??? ??? Parent ???? ??? Items |
| Entity ? Master Data | `Restrict` | ??? ??? ???????? ???????? |
| Optional FK | `Restrict` | ????? ?? Orphaned Records |

---

## ?? ???? ????: Purchase Configuration

### ??? ???????:
```csharp
public class PurchaseConfiguration : IEntityTypeConfiguration<Purchase>
{
    public void Configure(EntityTypeBuilder<Purchase> builder)
    {
        builder.HasKey(e => e.Id).HasName("PK_Purchases");
        builder.Property(e => e.Id).ValueGeneratedNever();
        builder.Property(e => e.TotalAmount).HasColumnType("decimal(18, 2)");
        
        // ???? default values
        // ???? collection configuration
        // ???? proper delete behavior
    }
}
```

### ??? ???????:
```csharp
public class PurchaseConfiguration : IEntityTypeConfiguration<Purchase>
{
    public void Configure(EntityTypeBuilder<Purchase> builder)
    {
        builder.HasKey(e => e.Id).HasName("PK_Purchases");
        
        builder.Property(e => e.Id).ValueGeneratedNever();
        builder.Property(e => e.PurchaseDate)
            .HasDefaultValueSql("GETUTCDATE()"); // ? Default
        builder.Property(e => e.TotalAmount)
            .HasColumnType("decimal(18, 2)")
            .HasDefaultValue(0); // ? Default

        builder.HasOne(d => d.Brand).WithMany(p => p.Purchases)
            .HasForeignKey(d => d.BrandId)
            .OnDelete(DeleteBehavior.Restrict); // ? Proper behavior

        builder.HasOne(d => d.Supplier).WithMany(p => p.Purchases)
            .HasForeignKey(d => d.SupplierId)
            .OnDelete(DeleteBehavior.Restrict);

        // ? Collection Configuration
        builder.HasMany(d => d.PurchaseItems)
            .WithOne(d => d.Purchase)
            .HasForeignKey(d => d.PurchaseId)
            .OnDelete(DeleteBehavior.Cascade);

        builder.Navigation(d => d.PurchaseItems).AutoInclude();
    }
}
```

---

## ?? Database Integrity

???? ??? Database ????:

? **Required Fields**: ???? Fields ???????? ??????  
? **Default Values**: ??? ???????? ??????  
? **Foreign Keys**: ?????? ????? ?? proper delete behaviors  
? **Unique Constraints**: ??? `(WarehouseId, BatchId)` unique  
? **Indexes**: ??? Performance ??? ?????? ??????  
? **Enum Conversion**: Enums ?????? ?? strings ????? ???????  

---

## ?? ???????:

1. **Type Safety**: Collections ????? ???? ???? ?? EF Core
2. **Performance**: AutoInclude ? Indexes ??????
3. **Data Integrity**: Delete behaviors ?????
4. **Database Clarity**: Enums ????? ?? Database
5. **Business Rules**: Default values ???? Business Logic
6. **Maintainability**: ?? Configuration ????? ? consistent

---

## ? ???? ?????????

| File | ????????? | ?????? |
|------|-----------|--------|
| BranchConfiguration | Collection + Restrict | ? |
| CustomerConfiguration | AutoInclude + Defaults | ? |
| EmployeeConfiguration | Defaults + IsRequired | ? |
| ProductConfiguration | 4 Collections | ? |
| ProductCategoryConfiguration | Collection + AutoInclude | ? |
| BatchConfiguration | 3 Collections + Defaults | ? |
| WarehouseConfiguration | 2 Collections + Enum | ? |
| WarehouseBatchConfiguration | Unique + Quantity | ? |
| StockMovementConfiguration | Enum + Defaults | ? |
| SupplierConfiguration | Collection + MaxLength | ? |
| PurchaseConfiguration | Cascade + Defaults | ? |
| PurchaseItemConfiguration | Collection + Restrict | ? |
| SaleConfiguration | Cascade + Enum + Defaults | ? |
| SaleItemConfiguration | IsRequired + Restrict | ? |
| AccountConfiguration | Enum + Collection | ? |
| JournalEntryConfiguration | Cascade + Defaults | ? |
| JournalEntryLineConfiguration | Indexes + Cascade | ? |
| ExpenseConfiguration | Defaults + Restrict | ? |
| ExpenseCategoryConfiguration | Collection + AutoInclude | ? |

---

## ?? ????? ??????:
- ? `Infrastructure/Configurations/BranchConfiguration.cs`
- ? `Infrastructure/Configurations/CustomerConfiguration.cs`
- ? `Infrastructure/Configurations/EmployeeConfiguration.cs`
- ? `Infrastructure/Configurations/ProductConfiguration.cs`
- ? `Infrastructure/Configurations/ProductCategoryConfiguration.cs`
- ? `Infrastructure/Configurations/BatchConfiguration.cs`
- ? `Infrastructure/Configurations/WarehouseConfiguration.cs`
- ? `Infrastructure/Configurations/WarehouseBatchConfiguration.cs`
- ? `Infrastructure/Configurations/StockMovementConfiguration.cs`
- ? `Infrastructure/Configurations/SupplierConfiguration.cs`
- ? `Infrastructure/Configurations/PurchaseConfiguration.cs`
- ? `Infrastructure/Configurations/PurchaseItemConfiguration.cs`
- ? `Infrastructure/Configurations/SaleConfiguration.cs`
- ? `Infrastructure/Configurations/SaleItemConfiguration.cs`
- ? `Infrastructure/Configurations/AccountConfiguration.cs`
- ? `Infrastructure/Configurations/JournalEntryConfiguration.cs`
- ? `Infrastructure/Configurations/JournalEntryLineConfiguration.cs`
- ? `Infrastructure/Configurations/ExpenseConfiguration.cs`
- ? `Infrastructure/Configurations/ExpenseCategoryConfiguration.cs`

---

## ?? ??????? ????????:

???? ??? Configurations:
- ? **???????** ?? ??????? ??????? ??????
- ? **????** ?? proper delete behaviors
- ? **??????** ?? indexes ? default values
- ? **?????** ?? required fields ? constraints
- ? **???? ????** ?? AutoInclude ??? Collections ??????
