# ????? ????? Dapper Queries ?? Snake_Case Convention

## ?? ??????

?? ????? ???? **Query Repositories** ?? ??????? ????? ?? `UseSnakeCaseNamingConvention()` ?? DbContext. ?? ????? ????? ????? ??????? ?? ????? ???????? `QueryRepository` ?????? ???? ??? SQL queries ???????? ????? ??????? ????? `snake_case`.

---

## ?? ????????? ????????

### 1. ????? ??????? ???????? `QueryRepository.cs`

?? ????? **22 ????** ?????? ??????? ????? snake_case:

```csharp
// Core Tables
protected const string TableAccounts = "accounts";
protected const string TableBatches = "batches";
protected const string TableBrands = "brands";
protected const string TableBranches = "branches";
protected const string TableBrandMemberships = "brand_memberships";

// Product Management
protected const string TableCustomers = "customers";
protected const string TableEmployees = "employees";
protected const string TableExpenses = "expenses";
protected const string TableExpenseCategories = "expense_categories";

// Journal & Accounting
protected const string TableJournalEntries = "journal_entries";
protected const string TableJournalEntryLines = "journal_entry_lines";

// Order Management
protected const string TableOrderItems = "order_items";
protected const string TableOrders = "orders";

// Product Catalog
protected const string TableProducts = "products";
protected const string TableProductCategories = "product_categories";

// Purchasing
protected const string TablePurchases = "purchases";
protected const string TablePurchaseItems = "purchase_items";

// Inventory
protected const string TableStockMovements = "stock_movements";
protected const string TableSuppliers = "suppliers";
protected const string TableWarehouses = "warehouses";
protected const string TableWarehouseBatches = "warehouse_batches";
```

### 2. ????? ???? Query Repositories (15 ???)

?? ????? ?? `QueryRepository` ???????? ???????:

#### ??? ???????:
```csharp
var query = "SELECT Id, Name, Type FROM Accounts WHERE Id = @Id";
```

#### ??? ???????:
```csharp
var query = $"SELECT id, name AS Name, type AS Type FROM {TableAccounts} WHERE id = @Id";
```

---

## ?? ??????? ???????

### Query Repositories ??????? (15 ???):

| # | ??? | ?????? | ???? |
|---|-----|--------|------|
| 1 | AccountQueryRepository.cs | accounts | ? |
| 2 | BatchQueryRepository.cs | batches | ? |
| 3 | BrandQueryRepository.cs | brands | ? |
| 4 | BranchQueryRepository.cs | branches | ? |
| 5 | CustomerQueryRepository.cs | customers | ? |
| 6 | EmployeeQueryRepository.cs | employees | ? |
| 7 | ExpenseCategoryQueryRepository.cs | expense_categories | ? |
| 8 | ExpenseQueryRepository.cs | expenses | ? |
| 9 | JournalEntryLineQueryRepository.cs | journal_entry_lines | ? |
| 10 | JournalEntryQueryRepository.cs | journal_entries | ? |
| 11 | OrderItemQueryRepository.cs | order_items | ? |
| 12 | OrderQueryRepository.cs | orders | ? |
| 13 | ProductCategoryQueryRepository.cs | product_categories | ? |
| 14 | ProductQueryRepository.cs | products | ? |
| 15 | PurchaseItemQueryRepository.cs | purchase_items | ? |
| 16 | PurchaseQueryRepository.cs | purchases | ? |
| 17 | StockMovementQueryRepository.cs | stock_movements | ? |
| 18 | SupplierQueryRepository.cs | suppliers | ? |
| 19 | WarehouseQueryRepository.cs | warehouses | ? |
| 20 | WarehouseBatchQueryRepository.cs | warehouse_batches | ? |
| 21 | UserQueryRepository.cs | asp_net_users | ? |

---

## ?? ??? ???????

### ????? ??????? ?????????:

```
PascalCase ? snake_case + AS Alias
```

**?????:**

| Original | Updated |
|----------|---------|
| `Id` | `id` |
| `BrandId` | `brand_id AS BrandId` |
| `FirstName` | `first_name AS FirstName` |
| `user_name` | `user_name AS UserName` |
| `CreatedAt` | `created_at AS CreatedAt` |
| `ExpenseDate` | `expense_date AS ExpenseDate` |

### ?? JOIN Statements:

```sql
-- ???:
FROM Orders o
INNER JOIN Customers c ON o.CustomerId = c.Id

-- ???:
FROM orders o
INNER JOIN customers c ON o.customer_id = c.id
```

---

## ? ???????

? **??????? ?????** ?? `UseSnakeCaseNamingConvention()`  
? **?? ???? ????? ?? ??? Dapper queries**  
? **????? ???????** - ??????? ?????? ?? ???? ????  
? **?????? ????? ?????????** - ???? Classes ???????? ?????? ?? ???????  
? **???? ???????** - ?? ???? ????? ????? ???????  

---

## ?? ???? ?????????

```
?? Infrastructure/Repositories/Queries/
??? Base/
?   ??? QueryRepository.cs ............................ +22 ????
??? AccountQueryRepository.cs ......................... ? ????
??? BatchQueryRepository.cs ........................... ? ????
??? BrandQueryRepository.cs ........................... ? ????
??? BranchQueryRepository.cs .......................... ? ????
??? CustomerQueryRepository.cs ........................ ? ????
??? EmployeeQueryRepository.cs ........................ ? ????
??? ExpenseCategoryQueryRepository.cs ................. ? ????
??? ExpenseQueryRepository.cs ......................... ? ????
??? JournalEntryLineQueryRepository.cs ............... ? ????
??? JournalEntryQueryRepository.cs ................... ? ????
??? OrderItemQueryRepository.cs ....................... ? ????
??? OrderQueryRepository.cs ........................... ? ????
??? ProductCategoryQueryRepository.cs ................ ? ????
??? ProductQueryRepository.cs ......................... ? ????
??? PurchaseItemQueryRepository.cs ................... ? ????
??? PurchaseQueryRepository.cs ........................ ? ????
??? StockMovementQueryRepository.cs .................. ? ????
??? SupplierQueryRepository.cs ........................ ? ????
??? WarehouseQueryRepository.cs ....................... ? ????
??? WarehouseBatchQueryRepository.cs ................. ? ????
??? UserQueryRepository.cs ............................ ? ????

?????? ?????????: 21 ???
```

---

## ?? ????? ?????????

### ???? 1: AccountQueryRepository

```csharp
// ???
public async Task<AccountDto?> GetByIdAsync(Guid id)
{
    var query = "SELECT Id, BrandId, Name, Type FROM Accounts WHERE Id = @Id";
    var parameters = new { Id = id };
    var result = await _connection.QuerySingleOrDefaultAsync<AccountDto>(query, parameters);
    return result;
}

// ???
public async Task<AccountDto?> GetByIdAsync(Guid id)
{
    var query = $"SELECT id, brand_id AS BrandId, name AS Name, type AS Type FROM {TableAccounts} WHERE id = @Id";
    var parameters = new { Id = id };
    var result = await _connection.QuerySingleOrDefaultAsync<AccountDto>(query, parameters);
    return result;
}
```

### ???? 2: OrderItemQueryRepository ?? JOIN

```csharp
// ???
public async Task<IEnumerable<OrderItemDto>> GetAllByBrandIdAsync(Guid brandId)
{
    var query = @"SELECT si.Id, si.OrderId, si.ProductId, si.BatchId, si.Quantity, si.UnitPrice, si.CostPrice 
                 FROM OrderItems si
                 INNER JOIN Orders s ON si.OrderId = s.Id
                 WHERE s.BrandId = @BrandId";
    var parameters = new { BrandId = brandId };
    var result = await _connection.QueryAsync<OrderItemDto>(query, parameters);
    return result;
}

// ???
public async Task<IEnumerable<OrderItemDto>> GetAllByBrandIdAsync(Guid brandId)
{
    var query = $@"SELECT si.id, si.order_id AS OrderId, si.product_id AS ProductId, si.batch_id AS BatchId, 
                    si.quantity AS Quantity, si.unit_price AS UnitPrice, si.cost_price AS CostPrice 
                 FROM {TableOrderItems} si
                 INNER JOIN {TableOrders} s ON si.order_id = s.id
                 WHERE s.brand_id = @BrandId";
    var parameters = new { BrandId = brandId };
    var result = await _connection.QueryAsync<OrderItemDto>(query, parameters);
    return result;
}
```

---

## ?? ?????? ?????????

?? ?????? ??:

- ? **?????? ??????** - ?? ???? ????? ?? ???????
- ? **?????? ???????** - ???? ??????? ????? ???? ????
- ? **?????????** - ???? ??? Dapper queries ?????

---

## ?? ??????? ??????? (?? ??? ?????)

??? ??? ???? ?? Query Repositories ???? ?? ????? ???? ???? ????? ?????:

1. ?????? ??? ?????? ?? `QueryRepository` ????? ?? ??? ?????? ??????
2. ??? ????? ??????? ?? PascalCase ??? snake_case
3. ??? `AS AliasName` ?????? ?????? ??? ??? DTO

```csharp
// ???? ???
var query = $@"SELECT 
    t.id,
    t.created_at AS CreatedAt,
    t.updated_at AS UpdatedAt
FROM {TableName} t
WHERE t.id = @Id";
```

---

## ?? ???????

- **Migration File:** `20260218013438_UseSnakeCaseNamingConvention.cs`
- **Base Repository:** `Infrastructure\Repositories\Queries\Base\QueryRepository.cs`
- **Query Repositories Path:** `Infrastructure\Repositories\Queries\`

---

**??????:** ? **????? ?????**  
**?????:** ????  
**??????:** ? ??? ???? ?????
